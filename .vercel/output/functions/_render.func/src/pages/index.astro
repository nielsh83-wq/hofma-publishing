---
import Layout from '../layouts/Layout.astro';
import BookCard from '../components/BookCard.astro';

const books = [
	{
		title: 'The European Countries Book - Extended Color Edition',
		description: 'Explore the countries of Europe in vibrant full color. This extended version features 4 pages for every country, including detailed maps, fun facts, and more.',
		price: null,
		imageUrl: 'https://images-na.ssl-images-amazon.com/images/P/B0G33G45CJ.jpg',
		amazonUrl: 'https://www.amazon.com/dp/B0G33G45CJ',
		badge: 'Recommended',
	},
	{
		title: 'The European Countries Book - Color Edition',
		description: 'Explore the countries of Europe in vibrant full color. This version features 2 pages for every country, including detailed maps, fun facts, and more.',
		price: null,
		imageUrl: 'https://images-na.ssl-images-amazon.com/images/P/B0FX9C7TS5.jpg',
		amazonUrl: 'https://www.amazon.com/dp/B0FX9C7TS5',
		badge: null,
	},
	{
		title: 'The European Countries Book - Black & White Edition',
		description: 'Explore the countries of Europe in black and white. This version features 2 pages for every country, including detailed maps, fun facts, and more.',
		price: null,
		imageUrl: 'https://images-na.ssl-images-amazon.com/images/P/B0FDRXJX7C.jpg',
		amazonUrl: 'https://www.amazon.com/dp/B0FDRXJX7C',
		badge: null,
	},
];
---

<Layout title="Hofma Publishing | Independent Publishing House">
	<!-- Hero -->
	<section class="pt-24 md:pt-32 pb-12 md:pb-16 px-6 bg-gradient-to-b from-amber-50/50 to-transparent">
		<div class="max-w-4xl mx-auto text-center">
			<h1 class="font-serif text-4xl md:text-6xl font-semibold text-stone-900 mb-4 tracking-tight">
				Hofma Publishing
			</h1>
			<p class="text-lg md:text-xl text-stone-500 max-w-2xl mx-auto" style="font-style: normal;">
				Personal book projects by Niels Hofma. Published simply for the love of great stories and the joy of sharing them with readers worldwide.
			</p>
		</div>
	</section>

	<!-- My Books -->
	<section class="pt-12 md:pt-16 pb-20 md:pb-28 px-6">
		<div class="max-w-6xl mx-auto">
			<div class="text-center mb-16">
				<h2 class="font-serif text-3xl md:text-4xl font-semibold text-stone-900 mb-3">
					My Books
				</h2>
				<p class="text-lg md:text-xl text-stone-500 max-w-2xl mx-auto">
					Below are the books I have published so far. New projects are always in the works, so stay updated by signing up for the newsletter below.
				</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 md:gap-12">
				{books.map((book) => (
					<BookCard
						title={book.title}
						description={book.description}
						price={book.price}
						imageUrl={book.imageUrl}
						amazonUrl={book.amazonUrl}
						badge={book.badge}
					/>
				))}
			</div>

			<p class="mt-14 text-center text-stone-500 text-sm md:text-base max-w-2xl mx-auto leading-relaxed">
				If you purchase a book, I would really appreciate it if you could leave a review on Amazon. Your feedback helps other readers discover these titles and means a lot to me.
			</p>
		</div>
	</section>

	<!-- Newsletter -->
	<section class="py-20 md:py-28 px-6 bg-gradient-to-b from-amber-50/50 to-transparent">
		<div class="max-w-xl mx-auto">
			<div class="text-center mb-10">
				<h2 class="font-serif text-3xl md:text-4xl font-semibold text-stone-900 mb-3">
					Newsletter
				</h2>
				<p class="text-stone-500">
					Stay updated with new releases, writing tips, and exclusive content.
				</p>
			</div>
			<form id="newsletter-form" class="flex flex-col sm:flex-row gap-3">
				<input
					type="email"
					name="email"
					id="newsletter-email"
					placeholder="Enter your email"
					required
					autocomplete="email"
					class="flex-1 px-4 py-3 rounded-lg border border-stone-200 bg-white text-stone-900 placeholder-stone-400 focus:outline-none focus:ring-2 focus:ring-amber-900/20 focus:border-amber-900 transition-colors"
				/>
				<button
					type="submit"
					id="newsletter-submit"
					class="px-6 py-3 bg-amber-900 hover:bg-amber-800 text-amber-50 font-semibold rounded-lg transition-colors disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 min-w-[140px]"
				>
					<span id="newsletter-submit-text">Subscribe</span>
					<span id="newsletter-spinner" class="hidden">
						<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
							<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
							<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
						</svg>
					</span>
				</button>
			</form>
			<p id="newsletter-message" class="mt-3 text-sm min-h-[1.25rem]" aria-live="polite"></p>
		</div>
	</section>

	<script>
		const form = document.getElementById('newsletter-form') as HTMLFormElement;
		const emailInput = document.getElementById('newsletter-email') as HTMLInputElement;
		const submitBtn = document.getElementById('newsletter-submit') as HTMLButtonElement;
		const submitText = document.getElementById('newsletter-submit-text')!;
		const spinner = document.getElementById('newsletter-spinner')!;
		const messageEl = document.getElementById('newsletter-message')!;

		const EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

		function setMessage(text: string, isError = false) {
			messageEl.textContent = text;
			messageEl.className = `mt-3 text-sm min-h-[1.25rem] ${isError ? 'text-amber-800' : 'text-stone-600'}`;
		}

		function setLoading(loading: boolean) {
			submitBtn.disabled = loading;
			submitText.classList.toggle('hidden', loading);
			spinner.classList.toggle('hidden', !loading);
		}

		form?.addEventListener('submit', async (e) => {
			e.preventDefault();
			const email = emailInput.value.trim().toLowerCase();
			setMessage('');

			if (!EMAIL_REGEX.test(email)) {
				setMessage('Please enter a valid email address.', true);
				return;
			}

			setLoading(true);
			try {
				const res = await fetch('/api/subscribe', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ email, source: 'website' }),
				});
				const data = await res.json();
				if (res.ok) {
					setMessage(data.message || 'Thank you for subscribing!');
					form.reset();
				} else {
					setMessage(data.error || 'Something went wrong. Please try again.', true);
				}
			} catch {
				setMessage('Something went wrong. Please try again.', true);
			} finally {
				setLoading(false);
			}
		});
	</script>
</Layout>
<!-- Fresh deploy trigger for Vercel -->
